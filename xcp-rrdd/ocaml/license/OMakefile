OCAMLINCLUDES +=  \
	$(ROOT)/ocaml/util \
	$(ROOT)/ocaml/http \
	$(ROOT)/ocaml/idl/ocaml_backend \
	$(ROOT)/ocaml/idl \
	$(ROOT)/ocaml/http \
	$(ROOT)/ocaml/autogen \
	$(ROOT)/ocaml/gpg \
	$(ROOT)/ocaml/xapi
	
OCAMLPACKS+=xmlm,xml-light2,stdext,uuid,str,mmap,xb,xs
OCAML_LIBS+=$(ROOT)/ocaml/idl/ocaml_backend/common $(ROOT)/ocaml/idl/ocaml_backend/client


IEXE=install -m 755 -o root -g root

V6FILES = \
	../util/server_io \
	../http/http_svr \
	../xapi/xapi_inventory \
	v6alert \
	fakev6 \
	v6xmlrpc \
	v6daemon

# Name of daemon to install in dom0:
V6D = v6testd

OCamlProgram(v6testd, $(V6FILES) v6testd)
OCamlProgram(v6d-reopen-logs, v6d_reopen_logs)

OCamlDocProgram(v6d, $(V6FILES))

.PHONY: install
install: $(V6D)
	mkdir -p $(DIST)/staging/opt/xensource/libexec
	$(IPROG) $(V6D) $(DIST)/staging/opt/xensource/libexec/v6d
	mkdir -p $(DIST)/staging/opt/xensource/bin
	$(IPROG) v6d-reopen-logs $(DIST)/staging/opt/xensource/bin

.PHONY: clean

clean:
	rm -f *.cmi *.cmx *.cmo *.a *.cma *.cmxa *.run *.opt *.annot *.o v6d v6testd v6d-reopen-logs

