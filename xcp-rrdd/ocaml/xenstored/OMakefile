OCAMLPACKS    += unix uuid mmap xc xb log eventchn
OCAMLINCLUDES += ../idl/ocaml_backend
OCAML_LIBS    +=
OCAML_CLIBS   += $(XEN_OCAML_CLIBS)
CFLAGS        += $(XEN_CFLAGS)

XENSTORED_FILES = event ../util/config \
             parse_arg connection connections define domain domains xenstored \
             perms process symbol store transaction utils quota disk logging

OCamlProgram(xenstored, $(XENSTORED_FILES))
OCamlDoc(xenstored, $(XENSTORED_FILES), $(OCAMLINCLUDES))

.DEFAULT: xenstored

.PHONY:clean
clean:
	rm -f $(CLEAN_OBJS) xenstored

.PHONY: install
install:
	mkdir -p $(DIST)/staging/opt/xensource/bin
	cp xenstored $(DIST)/staging/opt/xensource/bin
	mkdir -p $(DIST)/staging/etc/xensource
	cp xenstored.conf $(DIST)/staging/etc/xensource

.PHONY: sdk-install
sdk-install: install
