.SUBDIRS: examples templates host-backup-restore poweron

.PHONY: install
install:
	mkdir -p $(DIST)/staging/opt/xensource/bin
	mkdir -p $(DIST)/staging/var/patch
	mkdir -p $(DIST)/staging/var/patch/applied
	mkdir -p $(DIST)/staging/var/xapi
	mkdir -p $(DIST)/staging/etc/xensource
	mkdir -p $(DIST)/staging/etc/logrotate.d
	mkdir -p $(DIST)/staging/etc/xensource/master.d
	mkdir -p $(LIBEXEC)
	$(IPROG) fence $(DIST)/staging/opt/xensource/libexec	
	$(IPROG) xha-lc $(DIST)/staging/opt/xensource/libexec
	$(IPROG) xapi-health-check $(DIST)/staging/opt/xensource/libexec
	$(IPROG) license-check.py $(DIST)/staging/opt/xensource/libexec
	$(IPROG) mail-alarm $(DIST)/staging/opt/xensource/libexec
	$(IPROG) audit-logrotate $(DIST)/staging/etc/logrotate.d/audit
	$(IPROG) xapi-logrotate $(DIST)/staging/etc/logrotate.d/xapi
	$(IPROG) xapi-wait-init-complete $(DIST)/staging/opt/xensource/bin/
	$(IPROG) xapi-autostart-vms $(DIST)/staging/opt/xensource/bin/
	$(IPROG) udhcpd.skel $(DIST)/staging/var/xapi/udhcpd.skel
	$(IPROG) xapi-ssl.conf $(DIST)/staging/etc/xensource/xapi-ssl.conf
	$(IPROG) xapi.conf $(DIST)/staging/etc/xensource/xapi.conf
	$(IPROG) log.conf $(DIST)/staging/etc/xensource/log.conf
	$(IPROG) db.conf.skel $(DIST)/staging/etc/xensource/db.conf
	$(IPROG) rio.db.conf.skel $(DIST)/staging/etc/xensource/db.conf.rio
	mkdir -p $(DIST)/staging/etc/rc.d/init.d
	$(IPROG) init.d-xenservices $(DIST)/staging/etc/rc.d/init.d/xenservices
	$(IPROG) init.d-xapi $(DIST)/staging/etc/rc.d/init.d/xapi
	$(IPROG) init.d-xapissl $(DIST)/staging/etc/rc.d/init.d/xapissl
	$(IPROG) init.d-xapi-domains $(DIST)/staging/etc/rc.d/init.d/xapi-domains
	$(IPROG) init.d-squeezed $(DIST)/staging/etc/rc.d/init.d/squeezed
	$(IPROG) init.d-management-interface $(DIST)/staging/etc/rc.d/init.d/management-interface
	$(IDATA) squeezed-logrotate $(DIST)/staging/etc/logrotate.d/squeezed
	$(IPROG) init.d-v6d $(DIST)/staging/etc/rc.d/init.d/v6d
	$(IDATA) v6d-logrotate $(DIST)/staging/etc/logrotate.d/v6d
	mkdir -p $(DIST)/staging/etc/xensource/master.d
	$(IPROG) on-master-start $(DIST)/staging/etc/xensource/master.d/01-example
	$(IPROG) mpathalert-daemon $(DIST)/staging/etc/xensource/master.d/03-mpathalert-daemon
	mkdir -p $(DIST)/staging/etc/sysconfig
	$(IPROG) sysconfig-xapi $(DIST)/staging/etc/sysconfig/xapi
	mkdir -p $(DIST)/staging/etc/udev
	$(IPROG) xen-backend.rules $(DIST)/staging/etc/udev/
	$(IPROG) xen-frontend.rules $(DIST)/staging/etc/udev/
	$(IPROG) generate_ssl_cert $(LIBEXEC)/
	$(IPROG) fix_firewall.sh $(DIST)/staging/opt/xensource/bin/
	mkdir -p $(DIST)/staging/opt/xensource/debug
	$(IPROG) debug_ha_query_liveset $(DIST)/staging/opt/xensource/debug
	$(IPROG) xe-scsi-dev-map $(DIST)/staging/opt/xensource/bin/
	$(IPROG) xe-mount-iso-sr $(DIST)/staging/opt/xensource/bin/
	$(IPROG) xe-set-iscsi-iqn $(DIST)/staging/opt/xensource/bin/
	$(IPROG) xe-toolstack-restart $(DIST)/staging/opt/xensource/bin/
	$(IPROG) xe-xentrace $(DIST)/staging/opt/xensource/bin/
	$(IPROG) xe-edit-bootloader $(DIST)/staging/opt/xensource/bin/
	$(IPROG) static-vdis $(DIST)/staging/opt/xensource/bin/
	$(IPROG) with-vdi $(DIST)/staging/opt/xensource/debug
	mkdir -p $(DIST)/staging/etc/udev/rules.d
	sh -c \
	'cd $(DIST)/staging/etc/udev/rules.d; \
	ln -sf ../xen-backend.rules; \
	ln -sf ../xen-frontend.rules'
	mkdir -p $(DIST)/staging/etc/xensource/scripts/
	$(IPROG) block block-frontend vif tap $(DIST)/staging/etc/xensource/scripts/
	$(IPROG) pool.conf $(DIST)/staging/etc/xensource/
	mkdir -p $(DIST)/staging/etc/pam.d
	$(IPROG) pam.d-xapi $(DIST)/staging/etc/pam.d/xapi
	$(IPROG) qemu-dm-wrapper vncterm-wrapper upload-wrapper logs-download $(LIBEXEC)/
	mkdir -p $(DIST)/staging/opt/xensource/packages/iso #omg XXX
	$(IPROG) interface-reconfigure $(LIBEXEC)
	$(IPROG) rewrite-management-interface $(LIBEXEC)
	$(IPROG) interface-visualise $(LIBEXEC)
	$(IPROG) logrotate.sh $(LIBEXEC)
	$(IPROG) xapi-rolling-upgrade-miami $(LIBEXEC)/xapi-rolling-upgrade
	$(IPROG) set-hostname $(LIBEXEC)
	$(IPROG) update-mh-info $(LIBEXEC)
	$(IPROG) host-bugreport-upload $(LIBEXEC)/host-bugreport-upload
	$(IPROG) xe-backup-metadata $(DIST)/staging/opt/xensource/bin/
	$(IPROG) xe-restore-metadata $(DIST)/staging/opt/xensource/bin/
	$(IPROG) link-vms-by-sr.py $(LIBEXEC)
	$(IPROG) print-custom-templates $(LIBEXEC)
	$(IPROG) backup-sr-metadata.py $(LIBEXEC)
	$(IPROG) restore-sr-metadata.py $(LIBEXEC)
	$(IPROG) probe-device-for-file $(LIBEXEC)
	$(IPROG) backup-metadata-cron $(LIBEXEC)
	$(IPROG) c_rehash $(LIBEXEC)
	$(IPROG) lw-force-domain-leave $(LIBEXEC)
	$(IPROG) init.d-perfmon $(DIST)/staging/etc/rc.d/init.d/perfmon
	mkdir -p $(DIST)/staging/etc/sysconfig
	$(IPROG) sysconfig-perfmon $(DIST)/staging/etc/sysconfig/perfmon
	$(IPROG) perfmon $(DIST)/staging/opt/xensource/bin/
	mkdir -p $(DIST)/staging/etc/xapi.d/plugins
	$(IPROG) plugins/perfmon $(DIST)/staging/etc/xapi.d/plugins/
	$(IPROG) plugins/extauth-hook $(DIST)/staging/etc/xapi.d/plugins/
	$(IPROG) plugins/extauth-hook-AD.py $(DIST)/staging/etc/xapi.d/plugins/
	$(IPROG) set-dom0-memory-target-from-packs $(LIBEXEC)

.PHONY: sdk-install
sdk-install: install
	cp motd $(SDK)/motd
	$(IPROG) init.d-sdkinit $(DIST)/staging/etc/rc.d/init.d/sdkinit
	mkdir -p $(DIST)/staging/usr/lib/python2.4/site-packages/xen/lowlevel
	touch $(DIST)/staging/usr/lib/python2.4/site-packages/xen/__init__.py
	touch $(DIST)/staging/usr/lib/python2.4/site-packages/xen/lowlevel/__init__.py
	cp xc.py $(DIST)/staging/usr/lib/python2.4/site-packages/xen/lowlevel

