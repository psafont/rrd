# Set this to some other value on systems with no Xen libs to
# build only the client stuff and the fakeserver.
COMPILE_XENSTUFF ?= yes
export COMPILE_XENSTUFF

PRODUCT_VERSION?=unknown
PRODUCT_BRAND?=Miamidev
BUILD_NUMBER?=6666
COMPILE_NATIVE?=yes
export PRODUCT_VERSION PRODUCT_BRAND BUILD_NUMBER

.PHONY: all
all:
	omake ocaml/util/version.ml
	omake phase1 phase2
	omake lib-uninstall
	omake lib-install
	omake phase3

.PHONY: phase3
phase3:
	omake phase3

.PHONY: api
api: all
	@ :

.PHONY: xapimon
xapimon:
	omake ocaml/xapimon/xapimon

.PHONY: stresstest
stresstest:
	omake ocaml/xapi/stresstest

.PHONY: cvm
cvm:
	omake ocaml/cvm/cvm

.PHONY: install
install:
	omake install

.PHONY: lib-install
lib-install:
	omake DESTDIR=$(DESTDIR) lib-install

.PHONY: lib-uninstall
lib-uninstall:
	omake lib-uninstall

.PHONY: sdk-install
sdk-install:
	omake sdk-install

.PHONY:patch
patch:
	omake patch

.PHONY: clean
clean:
	omake clean
	omake lib-uninstall
	rm -rf dist/staging
	rm -f .omakedb .omakedb.lock

.PHONY: otags
otags:
	otags -vi -r . -o tags

.PHONY: doc
# For the doc target, we need to have phase2 done in case autogenerated .ml files are required
doc:
	omake ocaml/util/version.ml
	omake phase1 phase2
	omake doc
